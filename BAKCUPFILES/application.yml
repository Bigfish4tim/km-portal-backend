# ==============================================
# ğŸ“ src/main/resources/application.yml
# ê³µí†µ ì„¤ì • íŒŒì¼
# ==============================================

# ì„œë²„ ì„¤ì •
server:
  port: 8080                    # ë°±ì—”ë“œ í¬íŠ¸ (í”„ë¡ íŠ¸ì—”ë“œëŠ” 3000)
  servlet:
    context-path: ""            # ì»¨í…ìŠ¤íŠ¸ íŒ¨ìŠ¤ ì—†ìŒ (ë£¨íŠ¸ ê²½ë¡œ)
    encoding:
      charset: UTF-8            # í•œê¸€ ì¸ì½”ë”© ì„¤ì •
      enabled: true
      force: true

# Spring ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
spring:
  application:
    name: km-portal-backend     # ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„

  # í”„ë¡œíŒŒì¼ ì„¤ì • (ê°œë°œí™˜ê²½ì€ dev, ìš´ì˜í™˜ê²½ì€ prod)
  profiles:
    active: dev                 # ê¸°ë³¸ì ìœ¼ë¡œ ê°œë°œí™˜ê²½ ì‚¬ìš©

  # JSON ì²˜ë¦¬ ì„¤ì •
  jackson:
    serialization:
      write-dates-as-timestamps: false    # ë‚ ì§œë¥¼ ISO 8601 í˜•ì‹ìœ¼ë¡œ ì¶œë ¥
    deserialization:
      fail-on-unknown-properties: false   # ì•Œ ìˆ˜ ì—†ëŠ” ì†ì„± ë¬´ì‹œ
    default-property-inclusion: non_null  # null ê°’ì€ JSONì— í¬í•¨í•˜ì§€ ì•ŠìŒ
    time-zone: Asia/Seoul                 # í•œêµ­ ì‹œê°„ëŒ€ ì„¤ì •

# ë¡œê·¸ ì„¤ì •
logging:
  level:
    com.kmportal.backend: DEBUG           # ìš°ë¦¬ íŒ¨í‚¤ì§€ëŠ” DEBUG ë ˆë²¨
    org.springframework.web: DEBUG       # Spring Web ê´€ë ¨ DEBUG
    org.springframework.security: DEBUG  # Spring Security DEBUG
    org.hibernate.SQL: DEBUG             # SQL ì¿¼ë¦¬ ì¶œë ¥
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE  # SQL íŒŒë¼ë¯¸í„° ì¶œë ¥
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# ê´€ë¦¬ ì—”ë“œí¬ì¸íŠ¸ ì„¤ì • (Spring Boot Actuator)
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics       # ë…¸ì¶œí•  ì—”ë“œí¬ì¸íŠ¸
  endpoint:
    health:
      show-details: always                 # í—¬ìŠ¤ì²´í¬ ìƒì„¸ ì •ë³´ í‘œì‹œ

---

# ==============================================
# ğŸ“ src/main/resources/application-dev.yml
# ê°œë°œí™˜ê²½ ì „ìš© ì„¤ì •
# ==============================================

spring:
  # ê°œë°œí™˜ê²½ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (H2 Database)
  datasource:
    url: jdbc:h2:mem:kmportal_dev           # ë©”ëª¨ë¦¬ DB ì‚¬ìš© (ì¬ì‹œì‘ì‹œ ì´ˆê¸°í™”ë¨)
    # url: jdbc:h2:file:./data/kmportal_dev # íŒŒì¼ DB ì‚¬ìš© (ë°ì´í„° ìœ ì§€ë¨)
    driver-class-name: org.h2.Driver
    username: sa                            # H2 ê¸°ë³¸ ì‚¬ìš©ìëª…
    password:                               # H2 ê¸°ë³¸ íŒ¨ìŠ¤ì›Œë“œ (ë¹ˆê°’)

  # H2 Database ì›¹ ì½˜ì†” ì„¤ì •
  h2:
    console:
      enabled: true                         # H2 ì›¹ ì½˜ì†” í™œì„±í™”
      path: /h2-console                     # ì ‘ì† ê²½ë¡œ: http://localhost:8080/h2-console
      settings:
        web-allow-others: true              # ì™¸ë¶€ ì ‘ì† í—ˆìš© (ê°œë°œí™˜ê²½ë§Œ)

  # JPA ì„¤ì •
  jpa:
    hibernate:
      ddl-auto: create-drop                 # ì‹œì‘ì‹œ í…Œì´ë¸” ìƒì„±, ì¢…ë£Œì‹œ ì‚­ì œ (ê°œë°œí™˜ê²½)
      # ddl-auto: update                    # ìŠ¤í‚¤ë§ˆ ë³€ê²½ì‹œë§Œ ì—…ë°ì´íŠ¸ (ë°ì´í„° ë³´ì¡´)
    show-sql: true                          # SQL ì¿¼ë¦¬ ì½˜ì†” ì¶œë ¥
    properties:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect  # H2 ë°©ì–¸ ì‚¬ìš©
        format_sql: true                    # SQL ì¿¼ë¦¬ í¬ë§·íŒ…
        use_sql_comments: true              # SQL ì£¼ì„ ì¶œë ¥
        default_batch_fetch_size: 100       # ë°°ì¹˜ í˜ì¹˜ í¬ê¸° ìµœì í™”
    defer-datasource-initialization: true   # ë°ì´í„° ì´ˆê¸°í™” ì§€ì—°

  # SQL ì´ˆê¸°í™” ì„¤ì •
  sql:
    init:
      mode: always                          # í•­ìƒ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
      data-locations: classpath:data-dev.sql # ê°œë°œìš© ì´ˆê¸° ë°ì´í„°
      continue-on-error: false              # ì˜¤ë¥˜ ë°œìƒì‹œ ì¤‘ë‹¨

# ê°œë°œí™˜ê²½ ë¡œê·¸ ì„¤ì •
logging:
  level:
    org.springframework.web.servlet.DispatcherServlet: DEBUG
    org.springframework.transaction: DEBUG

---

# ==============================================
# ğŸ“ src/main/resources/application-prod.yml
# ìš´ì˜í™˜ê²½ ì „ìš© ì„¤ì •
# ==============================================

spring:
  # ìš´ì˜í™˜ê²½ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (MS SQL Server)
  datasource:
    url: jdbc:sqlserver://localhost:1433;databaseName=kmportal_prod;encrypt=false;trustServerCertificate=true
    driver-class-name: com.microsoft.sqlserver.jdbc.SQLServerDriver
    username: ${DB_USERNAME:kmportal_user}  # í™˜ê²½ë³€ìˆ˜ ë˜ëŠ” ê¸°ë³¸ê°’
    password: ${DB_PASSWORD:your_password}  # í™˜ê²½ë³€ìˆ˜ ë˜ëŠ” ê¸°ë³¸ê°’ (ì‹¤ì œë¡œëŠ” í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©)
    hikari:                                 # HikariCP ì»¤ë„¥ì…˜ í’€ ì„¤ì •
      maximum-pool-size: 20                 # ìµœëŒ€ ì»¤ë„¥ì…˜ ìˆ˜
      minimum-idle: 5                       # ìµœì†Œ ìœ íœ´ ì»¤ë„¥ì…˜ ìˆ˜
      connection-timeout: 30000             # ì»¤ë„¥ì…˜ íƒ€ì„ì•„ì›ƒ (30ì´ˆ)
      idle-timeout: 600000                  # ìœ íœ´ íƒ€ì„ì•„ì›ƒ (10ë¶„)
      max-lifetime: 1800000                 # ìµœëŒ€ ìƒëª…ì£¼ê¸° (30ë¶„)
      leak-detection-threshold: 60000       # ì»¤ë„¥ì…˜ ëˆ„ìˆ˜ ê°ì§€ ì„ê³„ê°’ (1ë¶„)

  # JPA ì„¤ì •
  jpa:
    hibernate:
      ddl-auto: validate                    # ìš´ì˜í™˜ê²½ì—ì„œëŠ” ìŠ¤í‚¤ë§ˆ ê²€ì¦ë§Œ ìˆ˜í–‰
    show-sql: false                         # ìš´ì˜í™˜ê²½ì—ì„œëŠ” SQL ì¶œë ¥ ì•ˆí•¨
    properties:
      hibernate:
        dialect: org.hibernate.dialect.SQLServerDialect  # SQL Server ë°©ì–¸
        default_batch_fetch_size: 100
        jdbc:
          batch_size: 50                    # ë°°ì¹˜ INSERT í¬ê¸°
        order_inserts: true                 # INSERT ìˆœì„œ ìµœì í™”
        order_updates: true                 # UPDATE ìˆœì„œ ìµœì í™”
        use_sql_comments: false             # ìš´ì˜í™˜ê²½ì—ì„œëŠ” SQL ì£¼ì„ ë¹„í™œì„±í™”

# ìš´ì˜í™˜ê²½ ë¡œê·¸ ì„¤ì •
logging:
  level:
    com.kmportal.backend: INFO              # ìš´ì˜í™˜ê²½ì—ì„œëŠ” INFO ë ˆë²¨
    org.springframework: WARN               # Spring ê´€ë ¨ ë¡œê·¸ ìµœì†Œí™”
    org.hibernate: WARN                     # Hibernate ë¡œê·¸ ìµœì†Œí™”
  file:
    name: logs/km-portal-backend.log        # ë¡œê·¸ íŒŒì¼ ê²½ë¡œ
  logback:
    rollingpolicy:
      max-file-size: 100MB                  # ë¡œê·¸ íŒŒì¼ ìµœëŒ€ í¬ê¸°
      max-history: 30                       # ë¡œê·¸ íŒŒì¼ ë³´ê´€ ì¼ìˆ˜