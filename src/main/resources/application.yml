# KM 포털 - Spring Boot 애플리케이션 설정파일
# 공통 설정 (모든 환경에서 적용되는 기본 설정)

spring:
  # 활성 프로필 설정 (개발환경: dev, 운영환경: prod)
  profiles:
    active: dev

  # JPA 및 Hibernate 설정
  jpa:
    # Hibernate 방언 설정 (데이터베이스 종류에 따른 SQL 방언)
    database-platform: org.hibernate.dialect.H2Dialect

    # JPA Hibernate 상세 설정
    hibernate:
      # DDL 자동 생성 옵션
      # create: 기존 테이블 삭제 후 새로 생성
      # create-drop: create + 애플리케이션 종료시 테이블 삭제
      # update: 기존 테이블 유지하고 변경사항만 적용
      # validate: 엔티티와 테이블 매핑 검증만 수행
      ddl-auto: create-drop

      # 물리적 네이밍 전략 (테이블명, 컬럼명 생성 규칙)
      # SpringPhysicalNamingStrategy: camelCase -> snake_case 변환
      physical-strategy: org.hibernate.boot.model.naming.SpringPhysicalNamingStrategy

      # 암시적 네이밍 전략 (명시되지 않은 이름 생성 규칙)
      implicit-strategy: org.hibernate.boot.model.naming.SpringImplicitNamingStrategy

    # JPA 실행 쿼리 출력 (개발시 유용)
    show-sql: true

    # JPA 구현체 프로퍼티
    properties:
      hibernate:
        # SQL 쿼리 포맷팅 (읽기 쉽게 정렬)
        format_sql: true
        # SQL 주석 표시 (어떤 엔티티에서 실행된 쿼리인지 표시)
        use_sql_comments: true
        # JDBC 배치 처리 최적화
        jdbc:
          batch_size: 20
        # 2차 캐시 설정
        cache:
          use_second_level_cache: false

  # 데이터베이스 초기화 설정
  sql:
    init:
      # 스키마 초기화 모드 (always: 항상, never: 안함, embedded: 임베디드DB만)
      mode: always
      # 스키마 파일 경로
      schema-locations: classpath:schema.sql
      # 데이터 파일 경로
      data-locations: classpath:data-dev.sql
      # 초기화 순서 (hibernate 이후 실행)
      defer-datasource-initialization: true

# JPA 관련 로깅 설정
logging:
  level:
    # JPA/Hibernate 관련 로그 레벨
    org.hibernate.SQL: DEBUG                    # 실행되는 SQL 쿼리 출력
    org.hibernate.type.descriptor.sql: TRACE    # SQL 파라미터 바인딩 값 출력
    org.hibernate.orm.jdbc.bind: TRACE          # JDBC 바인딩 파라미터 출력
    org.springframework.orm.jpa: DEBUG          # Spring JPA 로그
    org.springframework.transaction: DEBUG       # 트랜잭션 로그

    # 애플리케이션 패키지 로그 레벨
    com.kmportal: DEBUG

    # 루트 로그 레벨
    root: INFO

# 서버 설정
server:
  port: 8080
  servlet:
    context-path: /api
    encoding:
      charset: UTF-8
      force: true

# 매니지먼트 엔드포인트 (모니터링, 헬스체크 등)
management:
  endpoints:
    web:
      exposure:
        # 개발환경에서 모든 엔드포인트 노출
        include: "*"
  endpoint:
    health:
      # 헬스체크 상세 정보 표시
      show-details: always